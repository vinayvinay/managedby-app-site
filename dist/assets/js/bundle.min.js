const UserDetection={_userType:null,_trafficSource:null,getUserType(){if(this._userType!==null){return this._userType}const referrer=document.referrer.toLowerCase();const urlParams=window.location.search.toLowerCase();if(referrer.includes("google.co")&&urlParams.includes("international")){this._userType="international_landlord"}else if(referrer.includes("property")){this._userType="existing_landlord"}else if(urlParams.includes("inherited")){this._userType="accidental_landlord"}else{this._userType="unknown"}return this._userType},getTrafficSource(){if(this._trafficSource!==null){return this._trafficSource}const referrer=document.referrer.toLowerCase();if(referrer.includes("google.")){this._trafficSource="google_ads"}else if(referrer.includes("facebook")){this._trafficSource="facebook"}else if(referrer.includes("linkedin")){this._trafficSource="linkedin"}else if(referrer){this._trafficSource="referral"}else{this._trafficSource="direct"}return this._trafficSource},resetCache(){this._userType=null;this._trafficSource=null},getUserContext(){return{userType:this.getUserType(),trafficSource:this.getTrafficSource(),timestamp:Date.now(),url:window.location.href,referrer:document.referrer}}};window.UserDetection=UserDetection;const AnalyticsManager={config:{trackingId:"G-26Q381MZD0",conversionLabels:{lead_generation:"lead_generation"}},isLoaded:false,init(){if(this.isLoaded)return;window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}window.gtag=gtag;gtag("js",new Date);gtag("config",this.config.trackingId);const script=document.createElement("script");script.async=true;script.src=`https://www.googletagmanager.com/gtag/js?id=${this.config.trackingId}`;document.head.appendChild(script);this.isLoaded=true;this.setupEventTracking()},trackEvent(eventLabel,eventAction="cta_click",eventValue=1){if(window.gtag&&typeof window.gtag==="function"){gtag("event",eventAction,{event_category:"engagement",event_label:eventLabel,value:eventValue,user_type:UserDetection.getUserType(),traffic_source:UserDetection.getTrafficSource()})}},trackConversion(conversionLabel,value=1){if(window.gtag&&typeof window.gtag==="function"){gtag("event","conversion",{send_to:`${this.config.trackingId}/${conversionLabel}`,value:value,currency:"GBP",user_type:UserDetection.getUserType(),traffic_source:UserDetection.getTrafficSource()})}},setupEventTracking(){const ctaSelectors=[{selector:'a[href*="wa.me"]',label:"whatsapp"},{selector:'a[href*="calendly"]',label:"calendly"},{selector:'a[href*="mailto:"]',label:"email"}];ctaSelectors.forEach(cta=>{document.querySelectorAll(cta.selector).forEach(element=>{element.addEventListener("click",()=>{this.trackEvent(cta.label);if(["whatsapp","calendly","email"].includes(cta.label)){this.trackConversion(this.config.conversionLabels.lead_generation)}})})});const modalTrigger=document.getElementById("open-modal");if(modalTrigger){modalTrigger.addEventListener("click",()=>{this.trackEvent("modal_open")})}this.setupSectionTracking()},setupSectionTracking(){const sectionTimes={};const observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{const sectionId=entry.target.id;if(entry.isIntersecting){sectionTimes[sectionId]=Date.now()}else if(sectionTimes[sectionId]){const timeSpent=Date.now()-sectionTimes[sectionId];if(timeSpent>1e3){if(window.gtag&&typeof window.gtag==="function"){gtag("event","section_engagement",{event_category:"engagement",event_label:sectionId,value:Math.round(timeSpent/1e3)})}}delete sectionTimes[sectionId]}})},{threshold:.5});const sectionsToTrack=["hero-section","how-we-are-different-section","how-can-we-help-section","cta-section"];sectionsToTrack.forEach(sectionId=>{const section=document.getElementById(sectionId);if(section){observer.observe(section)}})}};window.AnalyticsManager=AnalyticsManager;const HeroAnimationManager={init(onCompleteCallback){if(!sessionStorage.getItem("heroAnimationPlayed")){this.playFirstTimeAnimation(onCompleteCallback)}else{this.playReturnVisitAnimation(onCompleteCallback)}},playFirstTimeAnimation(onCompleteCallback){const words=document.querySelectorAll(".word-reveal-js");words.forEach(word=>{const delay=parseFloat(word.dataset.delay)*1e3;setTimeout(()=>{word.classList.add("animate")},delay)});sessionStorage.setItem("heroAnimationPlayed","true");if(onCompleteCallback){setTimeout(onCompleteCallback,4e3)}},playReturnVisitAnimation(onCompleteCallback){document.querySelectorAll(".word-reveal-js").forEach(word=>{const delay=parseFloat(word.dataset.delay);if(delay<2){word.style.opacity="1";word.style.transform="translateY(0)"}else{setTimeout(()=>{word.style.opacity="1";word.style.transform="translateY(0)"},1e3)}});if(onCompleteCallback){setTimeout(onCompleteCallback,2500)}},resetAnimation(){sessionStorage.removeItem("heroAnimationPlayed");document.querySelectorAll(".word-reveal-js").forEach(word=>{word.classList.remove("animate");word.style.opacity="";word.style.transform=""})}};window.HeroAnimationManager=HeroAnimationManager;const StageSelector={stageButtons:null,serviceColumns:null,columns:null,init(){this.stageButtons=document.querySelectorAll(".stage-selector-btn");this.serviceColumns=document.getElementById("service-columns");this.columns=document.querySelectorAll(".service-column");this.attachEventListeners();this.handleStageSelection(1)},showColumns(columnsToShow){this.columns.forEach(column=>{column.style.display="none"});columnsToShow.forEach(columnNum=>{const column=document.querySelector(`[data-column="${columnNum}"]`);if(column){column.style.display="flex"}});this.updateGridLayout(columnsToShow.length)},updateGridLayout(columnCount){if(columnCount===1){this.serviceColumns.className="grid grid-cols-1 gap-8 lg:gap-12 max-w-md mx-auto"}else if(columnCount===2){this.serviceColumns.className="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 max-w-4xl mx-auto"}else{this.serviceColumns.className="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12"}},handleStageSelection(stage){this.stageButtons.forEach(btn=>btn.classList.remove("active"));const activeButton=document.querySelector(`[data-stage="${stage}"]`);if(activeButton){activeButton.classList.add("active")}switch(stage){case 1:this.showColumns([1,2,3]);break;case 2:this.showColumns([2,3]);break;default:this.showColumns([1,2,3])}},attachEventListeners(){this.stageButtons.forEach(button=>{button.addEventListener("click",()=>{const stage=parseInt(button.getAttribute("data-stage"));this.handleStageSelection(stage)})})}};window.StageSelector=StageSelector;const PrivacyManager={hasAnalyticsConsent(){const consent=localStorage.getItem("cookieConsent");return consent==="accepted"},saveConsent(choice){localStorage.setItem("cookieConsent",choice);localStorage.setItem("consentTimestamp",Date.now().toString())},loadAnalytics(){if(this.hasAnalyticsConsent()&&window.AnalyticsManager){window.AnalyticsManager.init()}},init(){if(this.hasAnalyticsConsent()){this.loadAnalytics()}}};document.addEventListener("DOMContentLoaded",function(){const privacyBanner=document.getElementById("privacy-banner");function showPrivacyBanner(){if(privacyBanner&&!localStorage.getItem("cookieConsent")){privacyBanner.classList.add("show")}}function hidePrivacyBanner(){if(privacyBanner){privacyBanner.classList.remove("show");privacyBanner.classList.add("hide")}}const acceptBtn=document.querySelector(".privacy-btn-accept");const declineBtn=document.querySelector(".privacy-btn-decline");if(acceptBtn){acceptBtn.addEventListener("click",function(){PrivacyManager.saveConsent("accepted");PrivacyManager.loadAnalytics();hidePrivacyBanner()})}if(declineBtn){declineBtn.addEventListener("click",function(){PrivacyManager.saveConsent("declined");hidePrivacyBanner()})}PrivacyManager.init();HeroAnimationManager.init(showPrivacyBanner);StageSelector.init();const ModalManager={contactModal:document.getElementById("contact-modal"),privacyModal:document.getElementById("privacy-modal"),init(){document.getElementById("open-modal").addEventListener("click",()=>this.openContact());document.querySelectorAll(".open-modal-btn").forEach(btn=>{btn.addEventListener("click",()=>{let ctaLocation="unknown";const heroSection=document.getElementById("hero-section");const differentSection=document.getElementById("how-we-are-different-section");const helpSection=document.getElementById("how-can-we-help-section");if(heroSection&&heroSection.contains(btn)){ctaLocation="hero_cta"}else if(differentSection&&differentSection.contains(btn)){ctaLocation="principles_cta"}else if(helpSection&&helpSection.contains(btn)){ctaLocation="pricing_cta"}if(window.AnalyticsManager){window.AnalyticsManager.trackEvent(ctaLocation,"cta_click")}this.openContact()})});document.getElementById("close-modal").addEventListener("click",()=>this.closeContact());this.contactModal.addEventListener("click",e=>{if(e.target===this.contactModal)this.closeContact()});document.getElementById("open-privacy-modal").addEventListener("click",e=>{e.preventDefault();this.openPrivacy()});document.getElementById("close-privacy-modal").addEventListener("click",()=>this.closePrivacy());this.privacyModal.addEventListener("click",e=>{if(e.target===this.privacyModal)this.closePrivacy()});document.addEventListener("keydown",e=>{if(e.key==="Escape"){if(!this.contactModal.classList.contains("hidden")){this.closeContact()}if(!this.privacyModal.classList.contains("hidden")){this.closePrivacy()}}})},openContact(){this.contactModal.classList.remove("hidden");document.body.style.overflow="hidden"},closeContact(){this.contactModal.classList.add("hidden");document.body.style.overflow="auto"},openPrivacy(){this.privacyModal.classList.remove("hidden");document.body.style.overflow="hidden"},closePrivacy(){this.privacyModal.classList.add("hidden");document.body.style.overflow="auto"}};ModalManager.init()});