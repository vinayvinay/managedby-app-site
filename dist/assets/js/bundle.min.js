const UserDetection={_userType:null,_trafficSource:null,getUserType(){if(this._userType!==null){return this._userType}const referrer=document.referrer.toLowerCase();const urlParams=window.location.search.toLowerCase();if(referrer.includes("google.co")&&urlParams.includes("international")){this._userType="international_landlord"}else if(referrer.includes("property")){this._userType="existing_landlord"}else if(urlParams.includes("inherited")){this._userType="accidental_landlord"}else{this._userType="unknown"}return this._userType},getTrafficSource(){if(this._trafficSource!==null){return this._trafficSource}const referrer=document.referrer.toLowerCase();if(referrer.includes("google.")){this._trafficSource="google_ads"}else if(referrer.includes("facebook")){this._trafficSource="facebook"}else if(referrer.includes("linkedin")){this._trafficSource="linkedin"}else if(referrer){this._trafficSource="referral"}else{this._trafficSource="direct"}return this._trafficSource}};window.UserDetection=UserDetection;const AnalyticsManager={config:{trackingId:"G-XPDJ9JE23Z",conversionLabels:{lead_generation:"lead_generation"}},isLoaded:false,init(){console.log("ðŸ”¥ AnalyticsManager.init() called. isLoaded:",this.isLoaded);if(this.isLoaded)return;window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}window.gtag=gtag;console.log("ðŸ”¥ Setting up gtag and dataLayer");gtag("js",new Date);gtag("config",this.config.trackingId,{page_title:document.title,page_location:window.location.href});console.log("ðŸ”¥ GA config sent");const script=document.createElement("script");script.async=true;script.src=`https://www.googletagmanager.com/gtag/js?id=${this.config.trackingId}`;console.log("ðŸ”¥ Loading GA script:",script.src);script.onload=()=>{console.log("ðŸ”¥ GA script loaded, setting up event tracking");setTimeout(()=>{console.log("ðŸ”¥ Sending test event to verify GA4");fetch("https://www.google-analytics.com/g/collect?v=2&tid="+this.config.trackingId+"&t=pageview&dl="+encodeURIComponent(location.href),{method:"GET",mode:"no-cors"}).then(()=>{console.log("ðŸ”¥ GA collect endpoint reachable")}).catch(err=>{console.log("ðŸ”¥ GA collect endpoint blocked or failed:",err)});gtag("event","page_view_test",{event_category:"test",test_param:"test_value"});console.log("ðŸ”¥ Test event sent");setTimeout(()=>{console.log("ðŸ”¥ Full dataLayer:",window.dataLayer)},500)},1e3);this.setupEventTracking()};script.onerror=()=>{console.error("ðŸ”¥ Failed to load GA script")};document.head.appendChild(script);this.isLoaded=true},trackEvent(eventName,eventAction="cta_click",customParams={}){console.log("ðŸ”¥ trackEvent called:",eventName,eventAction,customParams);console.log("ðŸ”¥ gtag available:",!!window.gtag,typeof window.gtag);if(window.gtag&&typeof window.gtag==="function"){const userType=window.UserDetection?window.UserDetection.getUserType():"unknown";const trafficSource=window.UserDetection?window.UserDetection.getTrafficSource():"unknown";const eventData={event_category:"engagement",custom_user_type:userType,custom_traffic_source:trafficSource,...customParams};console.log("ðŸ”¥ Sending GA event:",eventName,eventData);console.log("ðŸ”¥ Raw gtag call:","event",eventName,eventData);gtag("event",eventName,eventData);console.log("ðŸ”¥ dataLayer after event:",window.dataLayer.slice(-3));console.log("ðŸ”¥ GA functions available:",{gtag:typeof window.gtag,dataLayer:!!window.dataLayer,gtagLoaded:typeof window.gtagLoaded,ga:typeof window.ga})}else{console.log("ðŸ”¥ gtag not available, event not sent")}},trackConversion(conversionLabel,value=1){if(window.gtag&&typeof window.gtag==="function"){const userType=window.UserDetection?window.UserDetection.getUserType():"unknown";const trafficSource=window.UserDetection?window.UserDetection.getTrafficSource():"unknown";gtag("event","conversion",{send_to:`${this.config.trackingId}/${conversionLabel}`,value:value,currency:"GBP",user_type:userType,traffic_source:trafficSource})}},setupEventTracking(){console.log("ðŸ”¥ Setting up event tracking...");const ctaSelectors=[{selector:'a[href*="wa.me"]',label:"whatsapp"},{selector:'a[href*="calendly"]',label:"calendly"},{selector:'a[href*="mailto:"]',label:"email"}];ctaSelectors.forEach(cta=>{const elements=document.querySelectorAll(cta.selector);console.log(`ðŸ”¥ Found ${elements.length} elements for ${cta.selector}`);elements.forEach(element=>{console.log("ðŸ”¥ Adding click listener to:",element);element.addEventListener("click",()=>{console.log("ðŸ”¥ CTA clicked:",cta.label,element);const location=element.dataset.location||this.getLocation(element);this.trackEvent(cta.label,"click",{click_location:location});this.trackConversion(this.config.conversionLabels.lead_generation)})})});this.setupSectionTracking()},getLocation(element){if(document.getElementById("hero-section")?.contains(element))return"hero";if(document.getElementById("how-we-are-different-section")?.contains(element))return"principles";if(document.getElementById("how-can-we-help-section")?.contains(element))return"pricing";if(document.getElementById("cta-section")?.contains(element))return"cta";if(document.querySelector("footer")?.contains(element))return"footer";return"other"},setupSectionTracking(){const sectionTimes={};const self=this;const observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{const sectionId=entry.target.id;if(entry.isIntersecting){sectionTimes[sectionId]=Date.now()}else if(sectionTimes[sectionId]){const timeSpent=Date.now()-sectionTimes[sectionId];if(timeSpent>1e3){self.trackEvent("section_engagement","engagement",{section_name:sectionId,time_spent_seconds:Math.round(timeSpent/1e3)})}delete sectionTimes[sectionId]}})},{threshold:.5});const sectionsToTrack=["hero-section","how-we-are-different-section","how-can-we-help-section","cta-section"];sectionsToTrack.forEach(sectionId=>{const section=document.getElementById(sectionId);if(section){observer.observe(section)}})}};window.AnalyticsManager=AnalyticsManager;const HeroAnimationManager={init(onCompleteCallback){if(onCompleteCallback){setTimeout(onCompleteCallback,2e3)}}};window.HeroAnimationManager=HeroAnimationManager;const StageSelector={stageButtons:null,serviceColumns:null,columns:null,init(){this.stageButtons=document.querySelectorAll(".stage-selector-btn");this.serviceColumns=document.getElementById("service-columns");this.columns=document.querySelectorAll(".service-column");this.attachEventListeners();this.handleStageSelection(1)},showColumns(columnsToShow){this.columns.forEach(column=>{column.style.display="none"});columnsToShow.forEach(columnNum=>{const column=document.querySelector(`[data-column="${columnNum}"]`);if(column){column.style.display="flex"}});this.updateGridLayout(columnsToShow.length)},updateGridLayout(columnCount){if(columnCount===1){this.serviceColumns.className="grid grid-cols-1 gap-8 lg:gap-12 max-w-md mx-auto"}else if(columnCount===2){this.serviceColumns.className="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 max-w-4xl mx-auto"}else{this.serviceColumns.className="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12"}},handleStageSelection(stage){this.stageButtons.forEach(btn=>btn.classList.remove("active"));const activeButton=document.querySelector(`[data-stage="${stage}"]`);if(activeButton){activeButton.classList.add("active")}switch(stage){case 1:this.showColumns([1,2,3]);break;case 2:this.showColumns([2,3]);break;default:this.showColumns([1,2,3])}},attachEventListeners(){this.stageButtons.forEach(button=>{button.addEventListener("click",()=>{const stage=parseInt(button.getAttribute("data-stage"));this.handleStageSelection(stage)})})}};window.StageSelector=StageSelector;const PrivacyManager={hasAnalyticsConsent(){const consent=localStorage.getItem("cookieConsent");return consent==="accepted"},saveConsent(choice){localStorage.setItem("cookieConsent",choice);localStorage.setItem("consentTimestamp",Date.now().toString())},loadAnalytics(){console.log("ðŸ”¥ loadAnalytics called. Consent:",this.hasAnalyticsConsent(),"Manager available:",!!window.AnalyticsManager);if(this.hasAnalyticsConsent()&&window.AnalyticsManager){console.log("ðŸ”¥ Initializing AnalyticsManager...");window.AnalyticsManager.init()}},init(){if(this.hasAnalyticsConsent()){this.loadAnalytics()}}};document.addEventListener("DOMContentLoaded",function(){const privacyConsentModal=document.getElementById("privacy-consent-modal");function showPrivacyConsentModal(){if(privacyConsentModal&&!localStorage.getItem("cookieConsent")){privacyConsentModal.classList.remove("hidden");document.body.style.overflow="hidden"}}function hidePrivacyConsentModal(){if(privacyConsentModal){privacyConsentModal.classList.add("hidden");document.body.style.overflow="auto"}}const acceptBtn=document.querySelector(".privacy-btn-accept");const declineBtn=document.querySelector(".privacy-btn-decline");if(acceptBtn){acceptBtn.addEventListener("click",function(){PrivacyManager.saveConsent("accepted");PrivacyManager.loadAnalytics();hidePrivacyConsentModal()})}if(declineBtn){declineBtn.addEventListener("click",function(){PrivacyManager.saveConsent("declined");hidePrivacyConsentModal()})}console.log("ðŸ”¥ Initializing PrivacyManager...");PrivacyManager.init();console.log("ðŸ”¥ PrivacyManager initialized. Analytics consent:",PrivacyManager.hasAnalyticsConsent());console.log("ðŸ”¥ AnalyticsManager available:",!!window.AnalyticsManager);HeroAnimationManager.init(showPrivacyConsentModal);StageSelector.init();const ModalManager={contactModal:document.getElementById("contact-modal"),privacyModal:document.getElementById("privacy-modal"),init(){document.getElementById("open-modal").addEventListener("click",()=>{console.log("ðŸ”¥ Main CTA button clicked");if(window.AnalyticsManager){console.log("ðŸ”¥ AnalyticsManager available, tracking main CTA");window.AnalyticsManager.trackEvent("cta_click","click",{click_location:"get_started"})}else{console.log("ðŸ”¥ AnalyticsManager not available")}this.openContact("get_started")});document.querySelectorAll(".open-modal-btn").forEach(btn=>{btn.addEventListener("click",()=>{console.log("ðŸ”¥ Modal CTA button clicked:",btn);let ctaLocation="unknown";const heroSection=document.getElementById("hero-section");const differentSection=document.getElementById("how-we-are-different-section");const helpSection=document.getElementById("how-can-we-help-section");if(heroSection&&heroSection.contains(btn)){ctaLocation="hero"}else if(differentSection&&differentSection.contains(btn)){ctaLocation="principles"}else if(helpSection&&helpSection.contains(btn)){ctaLocation="pricing"}console.log("ðŸ”¥ CTA location detected:",ctaLocation);if(window.AnalyticsManager){console.log("ðŸ”¥ AnalyticsManager available, tracking modal CTA");window.AnalyticsManager.trackEvent("cta_click","click",{click_location:ctaLocation})}else{console.log("ðŸ”¥ AnalyticsManager not available")}this.openContact(ctaLocation)})});document.getElementById("close-modal").addEventListener("click",()=>this.closeContact());this.contactModal.addEventListener("click",e=>{if(e.target===this.contactModal)this.closeContact()});const openPrivacyModal=document.getElementById("open-privacy-modal");if(openPrivacyModal){openPrivacyModal.addEventListener("click",e=>{e.preventDefault();this.openPrivacy()})}document.getElementById("close-privacy-modal").addEventListener("click",()=>this.closePrivacy());this.privacyModal.addEventListener("click",e=>{if(e.target===this.privacyModal)this.closePrivacy()});document.addEventListener("keydown",e=>{if(e.key==="Escape"){if(!this.contactModal.classList.contains("hidden")){this.closeContact()}if(!this.privacyModal.classList.contains("hidden")){this.closePrivacy()}}})},openContact(location="modal"){const modalWhatsApp=this.contactModal.querySelector('a[href*="wa.me"]');const modalEmail=this.contactModal.querySelector('a[href*="mailto:"]');const modalCalendly=this.contactModal.querySelector('a[href*="calendly"]');if(modalWhatsApp)modalWhatsApp.setAttribute("data-location",location);if(modalEmail)modalEmail.setAttribute("data-location",location);if(modalCalendly)modalCalendly.setAttribute("data-location",location);this.contactModal.classList.remove("hidden");document.body.style.overflow="hidden"},closeContact(){this.contactModal.classList.add("hidden");document.body.style.overflow="auto"},openPrivacy(){this.privacyModal.classList.remove("hidden");document.body.style.overflow="hidden"},closePrivacy(){this.privacyModal.classList.add("hidden");document.body.style.overflow="auto"}};ModalManager.init();const rentSlider=document.getElementById("rent-slider");const rentValue=document.getElementById("rent-value");const ourPrice=document.getElementById("our-price");const traditionalPrice=document.getElementById("traditional-price");const annualSaving=document.getElementById("annual-saving");function updatePrices(rentAmount){if(rentValue){rentValue.textContent=`Â£${rentAmount.toLocaleString()}`}const ourMonthlyPrice=Math.round(rentAmount*.036);if(ourPrice){ourPrice.textContent=`Â£${ourMonthlyPrice}`}const traditionalMin=Math.round(rentAmount*.1);const traditionalMax=Math.round(rentAmount*.15);if(traditionalPrice){traditionalPrice.textContent=`Â£${traditionalMin}-Â£${traditionalMax}`}const annualSavingsMin=(traditionalMin-ourMonthlyPrice)*12;const annualSavingsMax=(traditionalMax-ourMonthlyPrice)*12;if(annualSaving){annualSaving.textContent=`Your annual saving: Â£${annualSavingsMin.toLocaleString()}-Â£${annualSavingsMax.toLocaleString()}.`}}if(rentSlider){updatePrices(parseInt(rentSlider.value));rentSlider.addEventListener("input",function(){updatePrices(parseInt(this.value))})}});